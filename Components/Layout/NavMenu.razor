@using BlazorWebApp.Services
@inject TabService TabService
@inject NavigationManager NavManager

<div class="nav-scrollable @(IsExpanded ? "expanded" : "")">
    <nav class="flex-column">
        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/"))" @onclick='() => OpenTab("Dashboard", "/", "bi-house-door")'>
                <div class="nav-icon"><span class="bi bi-house-door"></span></div>
                <div class="nav-text">Dashboard</div>
            </div>
        </div>

        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/data"))" @onclick='() => OpenTab("Veri Havuzu", "/data", "bi-table")'>
                <div class="nav-icon"><span class="bi bi-table"></span></div>
                <div class="nav-text">Veri Havuzu</div>
            </div>
        </div>

        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/data-pool-2"))" @onclick='() => OpenTab("Veri Havuzu - 2", "/data-pool-2", "bi-lightning-charge")'>
                <div class="nav-icon"><span class="bi bi-lightning-charge"></span></div>
                <div class="nav-text">Veri Havuzu - 2</div>
            </div>
        </div>

        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/analytics"))" @onclick='() => OpenTab("Analiz Görünümü", "/analytics", "bi-grid-3x3-gap")'>
                <div class="nav-icon"><span class="bi bi-grid-3x3-gap"></span></div>
                <div class="nav-text">Analiz Görünümü</div>
            </div>
        </div>

        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/reports"))" @onclick='() => OpenTab("Raporlar", "/reports", "bi-file-earmark-bar-graph")'>
                <div class="nav-icon"><span class="bi bi-file-earmark-bar-graph"></span></div>
                <div class="nav-text">Raporlar</div>
            </div>
        </div>

        <div class="nav-item">
            <div class="nav-link @(GetActiveClass("/settings"))" @onclick='() => OpenTab("Ayarlar", "/settings", "bi-gear")'>
                <div class="nav-icon"><span class="bi bi-gear"></span></div>
                <div class="nav-text">Ayarlar</div>
            </div>
        </div>
    </nav>
</div>

@code {
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public EventCallback OnNavigate { get; set; }

    private async Task OpenTab(string title, string url, string icon)
    {
        await OnNavigate.InvokeAsync();
        TabService.AddTab(title, url, icon);
        NavManager.NavigateTo(url);
    }

    private string GetActiveClass(string url)
    {
        var currentUrl = NavManager.ToBaseRelativePath(NavManager.Uri);
        if (string.IsNullOrEmpty(currentUrl) && url == "/") return "active";
        return ("/" + currentUrl).Equals(url, StringComparison.OrdinalIgnoreCase) ? "active" : "";
    }
}

